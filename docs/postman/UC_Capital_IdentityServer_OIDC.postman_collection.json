{
	"info": {
		"_postman_id": "uc-capital-oidc-collection",
		"name": "UC Capital IdentityServer OIDC",
		"description": "## UC Capital Identity Server - OAuth 2.0 / OIDC æ¸¬è©¦é›†åˆ\n\næ­¤é›†åˆåŒ…å«æ‰€æœ‰æ¨™æº– OIDC ç«¯é»çš„æ¸¬è©¦ã€‚\n\n### æ¸¬è©¦æµç¨‹\n\n1. **Discovery** - å–å¾— OIDC è¨­å®š\n2. **Authorize** - åœ¨ç€è¦½å™¨é–‹å•Ÿæˆæ¬Š URL\n3. **Token** - ä½¿ç”¨æˆæ¬Šç¢¼äº¤æ› Token\n4. **UserInfo** - å–å¾—ä½¿ç”¨è€…è³‡è¨Š\n5. **Introspection** - é©—è­‰ Token\n6. **Revocation** - æ’¤éŠ· Token\n\n### ç’°å¢ƒè®Šæ•¸\n\nè«‹å…ˆè¨­å®šä»¥ä¸‹ç’°å¢ƒè®Šæ•¸ï¼š\n- `sts_base_url`: STS ä¼ºæœå™¨åŸºåº• URL\n- `client_id`: Client ID\n- `client_secret`: Client Secret (å¦‚æœæœ‰)\n- `redirect_uri`: é‡å°å‘ URI\n- `code_verifier`: PKCE Code Verifier\n- `authorization_code`: æˆæ¬Šç¢¼ (å¾ authorize å›èª¿å–å¾—)\n- `access_token`: Access Token\n- `refresh_token`: Refresh Token\n- `id_token`: ID Token",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"variable": [
		{
			"key": "sts_base_url",
			"value": "https://prs.uccapital.com.tw/sts",
			"type": "string"
		},
		{
			"key": "client_id",
			"value": "oauth_demo_client",
			"type": "string"
		},
		{
			"key": "client_secret",
			"value": "",
			"type": "string"
		},
		{
			"key": "redirect_uri",
			"value": "http://localhost:3001/callback",
			"type": "string"
		},
		{
			"key": "scope",
			"value": "openid profile email roles offline_access",
			"type": "string"
		},
		{
			"key": "code_verifier",
			"value": "dBjftJeZ4CVP-mB92K27uhbUJU1p1r_wW1gFWFOEjXk",
			"type": "string"
		},
		{
			"key": "code_challenge",
			"value": "my-qKsa9_RLKa5SfNGAVv95jEtxXJYsZfBDXDCwm6Qo",
			"type": "string"
		},
		{
			"key": "authorization_code",
			"value": "",
			"type": "string"
		},
		{
			"key": "access_token",
			"value": "",
			"type": "string"
		},
		{
			"key": "refresh_token",
			"value": "",
			"type": "string"
		},
		{
			"key": "id_token",
			"value": "",
			"type": "string"
		},
		{
			"key": "api_client_id",
			"value": "skoruba_identity_admin_api",
			"type": "string"
		},
		{
			"key": "api_client_secret",
			"value": "",
			"type": "string"
		},
		{
			"key": "state",
			"value": "",
			"type": "string"
		},
		{
			"key": "nonce",
			"value": "",
			"type": "string"
		}
	],
	"item": [
		{
			"name": "1. Discovery",
			"item": [
				{
					"name": "Get Discovery Document",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response has issuer\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.issuer).to.exist;",
									"    console.log(\"Issuer: \" + jsonData.issuer);",
									"});",
									"",
									"pm.test(\"Response has token_endpoint\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.token_endpoint).to.exist;",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{sts_base_url}}/.well-known/openid-configuration",
							"host": [
								"{{sts_base_url}}"
							],
							"path": [
								".well-known",
								"openid-configuration"
							]
						},
						"description": "## Discovery Document\n\nå–å¾— IdentityServer çš„ OIDC è¨­å®šæ–‡ä»¶ï¼ŒåŒ…å«æ‰€æœ‰ç«¯é» URL èˆ‡æ”¯æ´çš„åŠŸèƒ½ã€‚\n\n### é‡è¦æ¬„ä½\n\n- `issuer`: ç™¼è¡Œè€…è­˜åˆ¥\n- `authorization_endpoint`: æˆæ¬Šç«¯é»\n- `token_endpoint`: Token ç«¯é»\n- `userinfo_endpoint`: UserInfo ç«¯é»\n- `jwks_uri`: JWKS ç«¯é»\n- `scopes_supported`: æ”¯æ´çš„ Scopes\n- `grant_types_supported`: æ”¯æ´çš„ Grant Types"
					},
					"response": []
				},
				{
					"name": "Get JWKS (Public Keys)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response has keys array\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.keys).to.be.an('array');",
									"    console.log(\"Found \" + jsonData.keys.length + \" keys\");",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{sts_base_url}}/.well-known/openid-configuration/jwks",
							"host": [
								"{{sts_base_url}}"
							],
							"path": [
								".well-known",
								"openid-configuration",
								"jwks"
							]
						},
						"description": "## JSON Web Key Set (JWKS)\n\nå–å¾—ç”¨æ–¼é©—è­‰ JWT Token ç°½ç« çš„å…¬é‘°ã€‚\n\n### ç”¨é€”\n\n- æœ¬åœ°é©—è­‰ JWT Token\n- ä¸éœ€è¦å‘¼å« IdentityServer\n- é€Ÿåº¦å¿«ï¼Œä½†ç„¡æ³•åµæ¸¬ Token æ’¤éŠ·"
					},
					"response": []
				}
			],
			"description": "Discovery ç«¯é»ç”¨æ–¼å–å¾— IdentityServer çš„è¨­å®šè³‡è¨Šã€‚"
		},
		{
			"name": "2. Authorization (åœ¨ç€è¦½å™¨é–‹å•Ÿ)",
			"item": [
				{
					"name": "Generate Authorize URL",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// ç”¢ç”Ÿéš¨æ©Ÿ state (é˜² CSRF)",
									"var state = Math.random().toString(36).substring(2, 15);",
									"pm.collectionVariables.set(\"state\", state);",
									"console.log(\"Generated state: \" + state);"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// é€™å€‹è«‹æ±‚æœƒé‡å°å‘åˆ°ç™»å…¥é é¢",
									"// è«‹åœ¨ç€è¦½å™¨ä¸­é–‹å•Ÿæ­¤ URL",
									"",
									"var authorizeUrl = pm.request.url.toString();",
									"console.log(\"\\n========================================\");",
									"console.log(\"è«‹åœ¨ç€è¦½å™¨ä¸­é–‹å•Ÿä»¥ä¸‹ URL é€²è¡Œç™»å…¥ï¼š\");",
									"console.log(\"========================================\");",
									"console.log(authorizeUrl);",
									"console.log(\"========================================\");",
									"console.log(\"\\nç™»å…¥å®Œæˆå¾Œï¼Œå¾å›èª¿ URL å–å¾— code åƒæ•¸ï¼Œ\");",
									"console.log(\"ä¸¦è¨­å®šåˆ° authorization_code è®Šæ•¸ä¸­ã€‚\");"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{sts_base_url}}/connect/authorize?client_id={{client_id}}&redirect_uri={{redirect_uri}}&response_type=code&scope={{scope}}&code_challenge={{code_challenge}}&code_challenge_method=S256&state={{state}}",
							"host": [
								"{{sts_base_url}}"
							],
							"path": [
								"connect",
								"authorize"
							],
							"query": [
								{
									"key": "client_id",
									"value": "{{client_id}}",
									"description": "[å¿…å¡«] OAuth 2.0 Client ID"
								},
								{
									"key": "redirect_uri",
									"value": "{{redirect_uri}}",
									"description": "[å¿…å¡«] æˆæ¬Šå®Œæˆå¾Œçš„é‡å°å‘ URI"
								},
								{
									"key": "response_type",
									"value": "code",
									"description": "[å¿…å¡«] å›ºå®šç‚º code (Authorization Code Flow)"
								},
								{
									"key": "scope",
									"value": "{{scope}}",
									"description": "[å¿…å¡«] è«‹æ±‚çš„æ¬Šé™ç¯„åœï¼Œä»¥ç©ºæ ¼åˆ†éš”"
								},
								{
									"key": "code_challenge",
									"value": "{{code_challenge}}",
									"description": "[å¿…å¡«] PKCE Code Challenge = BASE64URL(SHA256(code_verifier))"
								},
								{
									"key": "code_challenge_method",
									"value": "S256",
									"description": "[å¿…å¡«] PKCE æ–¹æ³•ï¼Œå›ºå®šç‚º S256"
								},
								{
									"key": "state",
									"value": "{{state}}",
									"description": "[å»ºè­°] é˜² CSRF æ”»æ“Šçš„éš¨æ©Ÿç‹€æ…‹å€¼"
								}
							]
						},
						"description": "## Authorization Endpoint\n\n**è«‹åœ¨ç€è¦½å™¨ä¸­é–‹å•Ÿæ­¤ URL é€²è¡Œç™»å…¥ï¼**\n\n### å¿…è¦åƒæ•¸\n\n| åƒæ•¸ | èªªæ˜ |\n|------|------|\n| client_id | OAuth 2.0 Client ID |\n| redirect_uri | æˆæ¬Šå®Œæˆå¾Œçš„é‡å°å‘ URI |\n| response_type | å›ºå®šç‚º `code` |\n| scope | è«‹æ±‚çš„æ¬Šé™ç¯„åœ |\n| code_challenge | PKCE é©—è­‰ç¢¼ |\n| code_challenge_method | å›ºå®šç‚º `S256` |\n| state | é˜² CSRF éš¨æ©Ÿå€¼ |\n\n### æ¸¬è©¦æµç¨‹\n\n1. é»æ“Š Send æˆ–è¤‡è£½ URL\n2. åœ¨ç€è¦½å™¨ä¸­é–‹å•Ÿ\n3. ç™»å…¥ä¸¦åŒæ„æˆæ¬Š\n4. å¾å›èª¿ URL å–å¾— `code` åƒæ•¸\n5. å°‡ `code` è¨­å®šåˆ° `authorization_code` è®Šæ•¸\n\n### å›èª¿ URL ç¯„ä¾‹\n\n```\nhttp://localhost:3001/callback?code=XXXXX&scope=openid%20profile&state=abc123\n```"
					},
					"response": []
				}
			],
			"description": "æˆæ¬Šç«¯é» - éœ€è¦åœ¨ç€è¦½å™¨ä¸­é–‹å•Ÿï¼Œä¸èƒ½ç›´æ¥åœ¨ Postman åŸ·è¡Œã€‚"
		},
		{
			"name": "3. Token",
			"item": [
				{
					"name": "Exchange Code for Token (Authorization Code)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"var jsonData = pm.response.json();",
									"",
									"if (jsonData.access_token) {",
									"    pm.collectionVariables.set(\"access_token\", jsonData.access_token);",
									"    console.log(\"âœ… Access Token å·²å„²å­˜\");",
									"    ",
									"    // è§£æ JWT",
									"    var parts = jsonData.access_token.split('.');",
									"    if (parts.length === 3) {",
									"        var payload = JSON.parse(atob(parts[1]));",
									"        console.log(\"Token Payload:\", JSON.stringify(payload, null, 2));",
									"    }",
									"}",
									"",
									"if (jsonData.refresh_token) {",
									"    pm.collectionVariables.set(\"refresh_token\", jsonData.refresh_token);",
									"    console.log(\"âœ… Refresh Token å·²å„²å­˜\");",
									"}",
									"",
									"if (jsonData.id_token) {",
									"    pm.collectionVariables.set(\"id_token\", jsonData.id_token);",
									"    console.log(\"âœ… ID Token å·²å„²å­˜\");",
									"    ",
									"    // è§£æ ID Token",
									"    var parts = jsonData.id_token.split('.');",
									"    if (parts.length === 3) {",
									"        var payload = JSON.parse(atob(parts[1]));",
									"        console.log(\"ID Token Payload:\", JSON.stringify(payload, null, 2));",
									"    }",
									"}",
									"",
									"pm.test(\"Response has access_token\", function () {",
									"    pm.expect(jsonData.access_token).to.exist;",
									"});",
									"",
									"pm.test(\"Response has token_type Bearer\", function () {",
									"    pm.expect(jsonData.token_type).to.eql(\"Bearer\");",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/x-www-form-urlencoded"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "grant_type",
									"value": "authorization_code",
									"description": "[å¿…å¡«] å›ºå®šç‚º authorization_code",
									"type": "text"
								},
								{
									"key": "client_id",
									"value": "{{client_id}}",
									"description": "[å¿…å¡«] OAuth 2.0 Client ID",
									"type": "text"
								},
								{
									"key": "code",
									"value": "{{authorization_code}}",
									"description": "[å¿…å¡«] æˆæ¬Šç¢¼ (å¾ authorize å›èª¿å–å¾—)",
									"type": "text"
								},
								{
									"key": "redirect_uri",
									"value": "{{redirect_uri}}",
									"description": "[å¿…å¡«] é‡å°å‘ URI (éœ€èˆ‡ authorize è«‹æ±‚ç›¸åŒ)",
									"type": "text"
								},
								{
									"key": "code_verifier",
									"value": "{{code_verifier}}",
									"description": "[é¸å¡«] PKCE Code Verifierï¼Œè‹¥ authorize æ™‚æœ‰ç”¨ PKCE å‰‡å¿…å¡«",
									"type": "text",
									"disabled": true
								},
								{
									"key": "client_secret",
									"value": "{{client_secret}}",
									"description": "[é¸å¡«] Client Secretï¼ŒConfidential Client æ‰éœ€è¦",
									"type": "text",
									"disabled": true
								}
							]
						},
						"url": {
							"raw": "{{sts_base_url}}/connect/token",
							"host": [
								"{{sts_base_url}}"
							],
							"path": [
								"connect",
								"token"
							]
						},
						"description": "## Authorization Code Grant\n\nä½¿ç”¨æˆæ¬Šç¢¼äº¤æ› Access Tokenã€ID Token å’Œ Refresh Tokenã€‚\n\n### å‰ç½®æ¢ä»¶\n\n1. å·²åœ¨ç€è¦½å™¨å®Œæˆæˆæ¬Šæµç¨‹\n2. å·²å°‡æˆæ¬Šç¢¼è¨­å®šåˆ° `authorization_code` è®Šæ•¸\n\n### æˆåŠŸå›æ‡‰\n\n```json\n{\n  \"access_token\": \"eyJhbGciOiJSUzI1NiIs...\",\n  \"token_type\": \"Bearer\",\n  \"expires_in\": 3600,\n  \"refresh_token\": \"CfDJ8Nyxw...\",\n  \"id_token\": \"eyJhbGciOiJSUzI1NiIs...\",\n  \"scope\": \"openid profile email roles offline_access\"\n}\n```"
					},
					"response": []
				},
				{
					"name": "Refresh Token",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"var jsonData = pm.response.json();",
									"",
									"if (jsonData.access_token) {",
									"    pm.collectionVariables.set(\"access_token\", jsonData.access_token);",
									"    console.log(\"âœ… æ–°çš„ Access Token å·²å„²å­˜\");",
									"}",
									"",
									"if (jsonData.refresh_token) {",
									"    pm.collectionVariables.set(\"refresh_token\", jsonData.refresh_token);",
									"    console.log(\"âœ… æ–°çš„ Refresh Token å·²å„²å­˜\");",
									"}",
									"",
									"pm.test(\"Response has new access_token\", function () {",
									"    pm.expect(jsonData.access_token).to.exist;",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/x-www-form-urlencoded"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "grant_type",
									"value": "refresh_token",
									"description": "[å¿…å¡«] å›ºå®šç‚º refresh_token",
									"type": "text"
								},
								{
									"key": "client_id",
									"value": "{{client_id}}",
									"description": "[å¿…å¡«] OAuth 2.0 Client ID",
									"type": "text"
								},
								{
									"key": "refresh_token",
									"value": "{{refresh_token}}",
									"description": "[å¿…å¡«] Refresh Token",
									"type": "text"
								},
								{
									"key": "client_secret",
									"value": "{{client_secret}}",
									"description": "[é¸å¡«] Client Secretï¼ŒConfidential Client æ‰éœ€è¦",
									"type": "text",
									"disabled": true
								}
							]
						},
						"url": {
							"raw": "{{sts_base_url}}/connect/token",
							"host": [
								"{{sts_base_url}}"
							],
							"path": [
								"connect",
								"token"
							]
						},
						"description": "## Refresh Token Grant\n\nä½¿ç”¨ Refresh Token å–å¾—æ–°çš„ Access Tokenã€‚\n\n### å‰ç½®æ¢ä»¶\n\n- `refresh_token` è®Šæ•¸å·²è¨­å®š\n\n### èªªæ˜\n\n- æ¯æ¬¡ Refresh å¯èƒ½æœƒå–å¾—æ–°çš„ Refresh Token (Rotation)\n- èˆŠçš„ Refresh Token å¯èƒ½æœƒå¤±æ•ˆ"
					},
					"response": []
				},
				{
					"name": "Client Credentials (M2M)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"var jsonData = pm.response.json();",
									"",
									"if (jsonData.access_token) {",
									"    pm.collectionVariables.set(\"access_token\", jsonData.access_token);",
									"    console.log(\"âœ… Access Token å·²å„²å­˜\");",
									"}",
									"",
									"pm.test(\"Response has access_token\", function () {",
									"    pm.expect(jsonData.access_token).to.exist;",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/x-www-form-urlencoded"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "grant_type",
									"value": "client_credentials",
									"description": "[å¿…å¡«] å›ºå®šç‚º client_credentials",
									"type": "text"
								},
								{
									"key": "client_id",
									"value": "{{api_client_id}}",
									"description": "[å¿…å¡«] OAuth 2.0 Client ID",
									"type": "text"
								},
								{
									"key": "client_secret",
									"value": "{{api_client_secret}}",
									"description": "[å¿…å¡«] Client Secret",
									"type": "text"
								},
								{
									"key": "scope",
									"value": "skoruba_identity_admin_api",
									"description": "[é¸å¡«] è«‹æ±‚çš„æ¬Šé™ç¯„åœ",
									"type": "text",
									"disabled": true
								}
							]
						},
						"url": {
							"raw": "{{sts_base_url}}/connect/token",
							"host": [
								"{{sts_base_url}}"
							],
							"path": [
								"connect",
								"token"
							]
						},
						"description": "## Client Credentials Grant\n\nç”¨æ–¼ Machine-to-Machine (M2M) é€šè¨Šï¼Œä¸æ¶‰åŠä½¿ç”¨è€…ã€‚\n\n### å‰ç½®æ¢ä»¶\n\n- éœ€è¦è¨­å®š `api_client_id` å’Œ `api_client_secret` è®Šæ•¸\n- Client å¿…é ˆæ˜¯ Confidential Client (æœ‰ Secret)\n\n### é©ç”¨å ´æ™¯\n\n- å¾Œç«¯æœå‹™å°å¾Œç«¯æœå‹™çš„é€šè¨Š\n- æ’ç¨‹ä½œæ¥­\n- èƒŒæ™¯è™•ç†ç¨‹åº"
					},
					"response": []
				}
			],
			"description": "Token ç«¯é»ç”¨æ–¼äº¤æ›ã€æ›´æ–°æˆ–å–å¾— Tokenã€‚"
		},
		{
			"name": "4. UserInfo",
			"item": [
				{
					"name": "Get User Info",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"var jsonData = pm.response.json();",
									"",
									"pm.test(\"Response has sub claim\", function () {",
									"    pm.expect(jsonData.sub).to.exist;",
									"});",
									"",
									"console.log(\"User Info:\", JSON.stringify(jsonData, null, 2));"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{sts_base_url}}/connect/userinfo",
							"host": [
								"{{sts_base_url}}"
							],
							"path": [
								"connect",
								"userinfo"
							]
						},
						"description": "## UserInfo Endpoint\n\nä½¿ç”¨ Access Token å–å¾—ä½¿ç”¨è€…è³‡è¨Šã€‚\n\n### å‰ç½®æ¢ä»¶\n\n- `access_token` è®Šæ•¸å·²è¨­å®š\n- Token éœ€åŒ…å« `openid` scope\n\n### å›å‚³ Claims\n\nä¾æ“š Token çš„ scopeï¼š\n- `openid`: sub\n- `profile`: name, given_name, family_name, ...\n- `email`: email, email_verified\n- `roles`: role"
					},
					"response": []
				}
			],
			"description": "UserInfo ç«¯é»ç”¨æ–¼å–å¾—ä½¿ç”¨è€…çš„ Claims è³‡è¨Šã€‚"
		},
		{
			"name": "5. Introspection",
			"item": [
				{
					"name": "Introspect Token",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"var jsonData = pm.response.json();",
									"",
									"pm.test(\"Response has active field\", function () {",
									"    pm.expect(jsonData.active).to.exist;",
									"});",
									"",
									"if (jsonData.active) {",
									"    console.log(\"âœ… Token æœ‰æ•ˆ\");",
									"    console.log(\"Token Info:\", JSON.stringify(jsonData, null, 2));",
									"} else {",
									"    console.log(\"âŒ Token ç„¡æ•ˆæˆ–å·²æ’¤éŠ·\");",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/x-www-form-urlencoded"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"description": "[å¿…å¡«] è¦æª¢é©—çš„ Token",
									"type": "text"
								},
								{
									"key": "client_id",
									"value": "{{api_client_id}}",
									"description": "[å¿…å¡«] API Resource Client ID",
									"type": "text"
								},
								{
									"key": "client_secret",
									"value": "{{api_client_secret}}",
									"description": "[å¿…å¡«] API Resource Secret",
									"type": "text"
								},
								{
									"key": "token_type_hint",
									"value": "access_token",
									"description": "[é¸å¡«] Token é¡å‹æç¤º (access_token/refresh_token)",
									"type": "text",
									"disabled": true
								}
							]
						},
						"url": {
							"raw": "{{sts_base_url}}/connect/introspect",
							"host": [
								"{{sts_base_url}}"
							],
							"path": [
								"connect",
								"introspect"
							]
						},
						"description": "## Token Introspection\n\né©—è­‰ Token æ˜¯å¦æœ‰æ•ˆï¼Œä¸¦å–å¾— Token çš„è©³ç´°è³‡è¨Šã€‚\n\n### å‰ç½®æ¢ä»¶\n\n- éœ€è¦è¨­å®š `api_client_id` å’Œ `api_client_secret`\n- é€™äº› credentials æ‡‰è©²æ˜¯ API Resource çš„ï¼Œè€Œéä¸€èˆ¬ Client\n\n### ç”¨é€”\n\n- é©—è­‰ JWT Token æ˜¯å¦å·²è¢«æ’¤éŠ·\n- å–å¾— Token çš„è©³ç´°è³‡è¨Š (sub, scope, exp ç­‰)\n\n### é‡è¦èªªæ˜\n\nJWT Token æ˜¯ç„¡ç‹€æ…‹çš„ï¼Œæœ¬åœ°é©—è­‰ç„¡æ³•åµæ¸¬æ’¤éŠ·ã€‚\nä½¿ç”¨æ­¤ç«¯é»å¯ä»¥ç¢ºèª Token æ˜¯å¦å·²è¢«æ’¤éŠ·ã€‚"
					},
					"response": []
				}
			],
			"description": "Introspection ç«¯é»ç”¨æ–¼é©—è­‰ Token ä¸¦å–å¾—è©³ç´°è³‡è¨Šã€‚"
		},
		{
			"name": "6. Revocation",
			"item": [
				{
					"name": "Revoke Access Token",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"console.log(\"âœ… Token æ’¤éŠ·è«‹æ±‚å·²é€å‡º\");",
									"console.log(\"ğŸ’¡ è«‹ä½¿ç”¨ Introspection ç¢ºèª Token æ˜¯å¦å·²å¤±æ•ˆ\");"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/x-www-form-urlencoded"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"description": "[å¿…å¡«] è¦æ’¤éŠ·çš„ Token",
									"type": "text"
								},
								{
									"key": "client_id",
									"value": "{{client_id}}",
									"description": "[å¿…å¡«] OAuth 2.0 Client ID",
									"type": "text"
								},
								{
									"key": "token_type_hint",
									"value": "access_token",
									"description": "[é¸å¡«] Token é¡å‹æç¤º",
									"type": "text",
									"disabled": true
								},
								{
									"key": "client_secret",
									"value": "{{client_secret}}",
									"description": "[é¸å¡«] Client Secretï¼ŒConfidential Client æ‰éœ€è¦",
									"type": "text",
									"disabled": true
								}
							]
						},
						"url": {
							"raw": "{{sts_base_url}}/connect/revocation",
							"host": [
								"{{sts_base_url}}"
							],
							"path": [
								"connect",
								"revocation"
							]
						},
						"description": "## Revoke Access Token\n\næ’¤éŠ· Access Tokenï¼Œä½¿å…¶å¤±æ•ˆã€‚\n\n### å¿…è¦åƒæ•¸\n\n| åƒæ•¸ | èªªæ˜ |\n|------|------|\n| token | è¦æ’¤éŠ·çš„ Token |\n| client_id | OAuth 2.0 Client ID |\n\n### é‡è¦èªªæ˜\n\nâš ï¸ **JWT Token æ˜¯ç„¡ç‹€æ…‹çš„**\n\næ’¤éŠ·å¾Œï¼š\n- ä½¿ç”¨æœ¬åœ°é©—è­‰ (JWKS) çš„æœå‹™**ç„¡æ³•åµæ¸¬**æ’¤éŠ·\n- å¿…é ˆä½¿ç”¨ Introspection ç«¯é»æ‰èƒ½ç¢ºèªæ˜¯å¦å·²æ’¤éŠ·"
					},
					"response": []
				},
				{
					"name": "Revoke Refresh Token",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"console.log(\"âœ… Refresh Token æ’¤éŠ·æˆåŠŸ\");",
									"console.log(\"ğŸ’¡ ä¹‹å¾Œç„¡æ³•å†ä½¿ç”¨æ­¤ Refresh Token æ›´æ–° Access Token\");"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/x-www-form-urlencoded"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "token",
									"value": "{{refresh_token}}",
									"description": "[å¿…å¡«] è¦æ’¤éŠ·çš„ Refresh Token",
									"type": "text"
								},
								{
									"key": "client_id",
									"value": "{{client_id}}",
									"description": "[å¿…å¡«] OAuth 2.0 Client ID",
									"type": "text"
								},
								{
									"key": "token_type_hint",
									"value": "refresh_token",
									"description": "[é¸å¡«] Token é¡å‹æç¤º",
									"type": "text",
									"disabled": true
								},
								{
									"key": "client_secret",
									"value": "{{client_secret}}",
									"description": "[é¸å¡«] Client Secretï¼ŒConfidential Client æ‰éœ€è¦",
									"type": "text",
									"disabled": true
								}
							]
						},
						"url": {
							"raw": "{{sts_base_url}}/connect/revocation",
							"host": [
								"{{sts_base_url}}"
							],
							"path": [
								"connect",
								"revocation"
							]
						},
						"description": "## Revoke Refresh Token\n\næ’¤éŠ· Refresh Tokenï¼Œä½¿å…¶ç„¡æ³•å†ç”¨æ–¼æ›´æ–° Access Tokenã€‚\n\n### å¿…è¦åƒæ•¸\n\n| åƒæ•¸ | èªªæ˜ |\n|------|------|\n| token | è¦æ’¤éŠ·çš„ Refresh Token |\n| client_id | OAuth 2.0 Client ID |\n\n### èªªæ˜\n\n- Refresh Token æ’¤éŠ·å¾Œç«‹å³å¤±æ•ˆ\n- å·²ç™¼å‡ºçš„ Access Token ä»æœ‰æ•ˆç›´åˆ°éæœŸ"
					},
					"response": []
				}
			],
			"description": "Revocation ç«¯é»ç”¨æ–¼æ’¤éŠ· Tokenã€‚"
		},
		{
			"name": "7. End Session (åœ¨ç€è¦½å™¨é–‹å•Ÿ)",
			"item": [
				{
					"name": "Generate Logout URL",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"var logoutUrl = pm.request.url.toString();",
									"console.log(\"\\n========================================\");",
									"console.log(\"è«‹åœ¨ç€è¦½å™¨ä¸­é–‹å•Ÿä»¥ä¸‹ URL é€²è¡Œç™»å‡ºï¼š\");",
									"console.log(\"========================================\");",
									"console.log(logoutUrl);",
									"console.log(\"========================================\");"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{sts_base_url}}/connect/endsession",
							"host": [
								"{{sts_base_url}}"
							],
							"path": [
								"connect",
								"endsession"
							],
							"query": [
								{
									"key": "id_token_hint",
									"value": "{{id_token}}",
									"description": "[é¸å¡«] ID Tokenï¼Œç”¨æ–¼è­˜åˆ¥è¦ç™»å‡ºçš„ Session",
									"disabled": true
								},
								{
									"key": "post_logout_redirect_uri",
									"value": "{{redirect_uri}}",
									"description": "[é¸å¡«] ç™»å‡ºå¾Œé‡å°å‘ URI (éœ€å·²è¨»å†Š)",
									"disabled": true
								}
							]
						},
						"description": "## End Session Endpoint\n\n**è«‹åœ¨ç€è¦½å™¨ä¸­é–‹å•Ÿæ­¤ URL é€²è¡Œç™»å‡ºï¼**\n\n### åƒæ•¸èªªæ˜\n\n| åƒæ•¸ | å¿…å¡« | èªªæ˜ |\n|------|------|------|\n| id_token_hint | é¸å¡« | ç”¨æ–¼è­˜åˆ¥è¦ç™»å‡ºçš„ Session |\n| post_logout_redirect_uri | é¸å¡« | ç™»å‡ºå¾Œé‡å°å‘ URI |\n\n### æµç¨‹\n\n1. è¤‡è£½æ­¤è«‹æ±‚çš„ URL\n2. åœ¨ç€è¦½å™¨ä¸­é–‹å•Ÿ\n3. IdentityServer æœƒæ¸…é™¤ Session ä¸¦ç™»å‡º"
					},
					"response": []
				}
			],
			"description": "End Session ç«¯é»ç”¨æ–¼ç™»å‡ºã€‚éœ€åœ¨ç€è¦½å™¨ä¸­é–‹å•Ÿã€‚"
		},
		{
			"name": "Utils",
			"item": [
				{
					"name": "Generate PKCE",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// ç”¢ç”Ÿ code_verifier (43-128 å­—å…ƒ)",
									"function generateCodeVerifier() {",
									"    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~';",
									"    let result = '';",
									"    for (let i = 0; i < 64; i++) {",
									"        result += chars.charAt(Math.floor(Math.random() * chars.length));",
									"    }",
									"    return result;",
									"}",
									"",
									"// Base64URL ç·¨ç¢¼",
									"function base64UrlEncode(str) {",
									"    return btoa(str)",
									"        .replace(/\\+/g, '-')",
									"        .replace(/\\//g, '_')",
									"        .replace(/=/g, '');",
									"}",
									"",
									"var codeVerifier = generateCodeVerifier();",
									"pm.collectionVariables.set(\"code_verifier\", codeVerifier);",
									"",
									"console.log(\"========================================\");",
									"console.log(\"PKCE Code Verifier (å·²å„²å­˜åˆ°è®Šæ•¸):\");",
									"console.log(codeVerifier);",
									"console.log(\"========================================\");",
									"console.log(\"\");",
									"console.log(\"âš ï¸ è«‹ä½¿ç”¨ä»¥ä¸‹ JavaScript è¨ˆç®— code_challenge:\");",
									"console.log(\"\");",
									"console.log(`async function generateCodeChallenge() {`);",
									"console.log(`    const encoder = new TextEncoder();`);",
									"console.log(`    const data = encoder.encode('${codeVerifier}');`);",
									"console.log(`    const hash = await crypto.subtle.digest('SHA-256', data);`);",
									"console.log(`    return btoa(String.fromCharCode(...new Uint8Array(hash)))`);",
									"console.log(`        .replace(/\\\\+/g, '-').replace(/\\\\//g, '_').replace(/=/g, '');`);",
									"console.log(`}`);",
									"console.log(\"\");",
									"console.log(\"æˆ–ä½¿ç”¨ç·šä¸Šå·¥å…·: https://tonyxu-io.github.io/pkce-generator/\");"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// é€™åªæ˜¯ä¸€å€‹å·¥å…·è«‹æ±‚ï¼Œä¸æœƒå¯¦éš›ç™¼é€",
									"console.log(\"Code Verifier å·²ç”¢ç”Ÿä¸¦å„²å­˜åˆ° code_verifier è®Šæ•¸\");"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "https://httpbin.org/get",
							"protocol": "https",
							"host": [
								"httpbin",
								"org"
							],
							"path": [
								"get"
							]
						},
						"description": "## ç”¢ç”Ÿ PKCE Code Verifier\n\nåŸ·è¡Œæ­¤è«‹æ±‚æœƒç”¢ç”Ÿéš¨æ©Ÿçš„ `code_verifier` ä¸¦å„²å­˜åˆ°è®Šæ•¸ã€‚\n\n### è¨ˆç®— Code Challenge\n\nPostman çš„ Pre-request Script ç„¡æ³•ä½¿ç”¨ `crypto.subtle`ï¼Œ\nè«‹ä½¿ç”¨ç€è¦½å™¨ Console æˆ–ç·šä¸Šå·¥å…·è¨ˆç®— `code_challenge`ã€‚\n\n### ç·šä¸Šå·¥å…·\n\n- https://tonyxu-io.github.io/pkce-generator/\n- https://www.oauth.com/playground/authorization-code-with-pkce.html"
					},
					"response": []
				},
				{
					"name": "Decode JWT Token",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"var token = pm.collectionVariables.get(\"access_token\");",
									"",
									"if (token) {",
									"    var parts = token.split('.');",
									"    if (parts.length === 3) {",
									"        console.log(\"========================================\");",
									"        console.log(\"JWT Token è§£æçµæœ\");",
									"        console.log(\"========================================\");",
									"        ",
									"        // Header",
									"        var header = JSON.parse(atob(parts[0]));",
									"        console.log(\"\\nHeader:\");",
									"        console.log(JSON.stringify(header, null, 2));",
									"        ",
									"        // Payload",
									"        var payload = JSON.parse(atob(parts[1]));",
									"        console.log(\"\\nPayload:\");",
									"        console.log(JSON.stringify(payload, null, 2));",
									"        ",
									"        // æª¢æŸ¥éæœŸæ™‚é–“",
									"        if (payload.exp) {",
									"            var expDate = new Date(payload.exp * 1000);",
									"            var now = new Date();",
									"            console.log(\"\\néæœŸæ™‚é–“: \" + expDate.toISOString());",
									"            if (expDate < now) {",
									"                console.log(\"âŒ Token å·²éæœŸ\");",
									"            } else {",
									"                var remaining = Math.floor((expDate - now) / 1000 / 60);",
									"                console.log(\"âœ… Token æœ‰æ•ˆï¼Œå‰©é¤˜ \" + remaining + \" åˆ†é˜\");",
									"            }",
									"        }",
									"        ",
									"        console.log(\"========================================\");",
									"    } else {",
									"        console.log(\"âŒ ç„¡æ•ˆçš„ JWT æ ¼å¼\");",
									"    }",
									"} else {",
									"    console.log(\"âŒ access_token è®Šæ•¸æœªè¨­å®š\");",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "https://httpbin.org/get",
							"protocol": "https",
							"host": [
								"httpbin",
								"org"
							],
							"path": [
								"get"
							]
						},
						"description": "## è§£æ JWT Token\n\nåŸ·è¡Œæ­¤è«‹æ±‚æœƒè§£æ `access_token` è®Šæ•¸ä¸­çš„ JWT Tokenï¼Œ\nä¸¦é¡¯ç¤º Headerã€Payload å’ŒéæœŸæ™‚é–“ã€‚\n\n### è¼¸å‡ºè³‡è¨Š\n\n- Header (alg, typ, kid)\n- Payload (sub, scope, exp, iss, aud ç­‰)\n- éæœŸç‹€æ…‹"
					},
					"response": []
				}
			],
			"description": "å·¥å…·è«‹æ±‚ï¼Œç”¨æ–¼ç”¢ç”Ÿ PKCE å’Œè§£æ JWTã€‚"
		}
	]
}
